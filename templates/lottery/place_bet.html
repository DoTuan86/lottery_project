{% extends "base.html" %}

{% block content %}
<h2>Đặt cược XS</h2>

<p>Số dư của bạn: <strong>{{ request.user.wallet.balance|floatformat:2 }}đ</strong></p>

{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li class="{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}
<form method="post">
    {% csrf_token %}

    <p>
        <label for="{{ form.station.id_for_label }}">{{ form.station.label }}:</label>
        <select name="{{ form.station.name }}" id="{{ form.station.id_for_label }}">
            {% for group_name, group_choices in form.station.field.choices %}
                <optgroup label="{{ group_name }}">
                    {% for value, label in group_choices %}
                        <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </optgroup>
            {% endfor %}
        </select>
    </p>
    <p>
        <label for="{{ form.bet_type.id_for_label }}">{{ form.bet_type.label }}:</label>
        {{ form.bet_type }}
    </p>
    <p>
        <label for="{{ form.number.id_for_label }}">{{ form.number.label }}:</label>
        {{ form.number }}
    </p>
    <p>
        <label for="{{ form.amount.id_for_label }}">{{ form.amount.label }}:</label>
        {{ form.amount }}
    </p>

    <button type="submit">Xác nhận cược</button>
</form>

<hr>

<h3>Các cược hôm nay ({{ today_date_for_display|date:"d/m/Y" }})</h3>
<ul>
    {% for bet in today_bets %}
    <li>
        <strong>Đài: {{ bet.station.name }}</strong>
        (Lúc: {{ bet.created_at|time:"H:i" }}) -
        [{{ bet.get_status_display }}] -
        {{ bet.get_bet_type_display }} <strong>{{ bet.number }}</strong> -
        Số tiền: {{ bet.amount }}đ
        {% if bet.status == 'WON' %}
            (Thắng: {{ bet.winnings }}đ)
        {% endif %}
        {% if bet.status == 'PENDING' %}
            <a href="{% url 'delete_bet' bet.id %}"
               onclick="return confirm('Bạn chắc chắn muốn xóa cược này?');"
               style="color: red; margin-left: 10px;">
               [Xóa]
            </a>
        {% endif %}
    </li>
    {% empty %}
    <li>Bạn chưa có cược nào hôm nay.</li>
    {% endfor %}
</ul>

<hr>
<h3>Các cược cho ngày mai ({{ tomorrow_date_for_display|date:"d/m/Y" }})</h3>
<ul>
    {% for bet in tomorrow_bets %}
    <li>
        <strong>Đài: {{ bet.station.name }}</strong>
        (Lúc: {{ bet.created_at|time:"H:i" }}) -
        [Chờ xử lý] -
        {{ bet.get_bet_type_display }} <strong>{{ bet.number }}</strong> -
        Số tiền: {{ bet.amount }}đ
        <a href="{% url 'delete_bet' bet.id %}"
           onclick="return confirm('Bạn chắc chắn muốn xóa cược này?');"
           style="color: red; margin-left: 10px;">
           [Xóa]
        </a>
    </li>
    {% empty %}
    <li>Bạn chưa có cược nào cho ngày mai.</li>
    {% endfor %}
</ul>
{% endblock %}