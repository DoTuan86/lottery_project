{% extends "base.html" %}

{% block content %}
<h2>Đặt cược XSMB</h2>

{% if is_after_cutoff %}
    <p style="color: red; font-weight: bold; background: #fff3f3; padding: 10px; border-radius: 5px;">
        Đã qua 18h00. Mọi cược đặt bây giờ sẽ được tính cho ngày mai ({{ bet_date_for_display|date:"d/m/Y" }}).
    </p>
{% endif %}

<p>Số dư của bạn: <strong>{{ request.user.wallet.balance|floatformat:2 }}đ</strong></p>

{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li class="{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" style="background-color: cyan; color: black; font-weight: bold; padding: 5px 10px; font-size: 1.4em;">Xác nhận cược</button>
</form>

<hr>

<h3>Các cược hôm nay ({{ today_date_for_display|date:"d/m/Y" }})</h3>
<ul>
    {% for bet in today_bets %}
    <li>
        [{{ bet.get_status_display }}] -
        Lúc: <strong>{{ bet.created_at|time:"H:i" }}</strong> -
        {{ bet.get_bet_type_display }} <strong>{{ bet.number }}</strong> -
        Số tiền: {{ bet.amount }}đ
        {% if bet.status == 'WON' %}
            (Thắng: {{ bet.winnings }}đ)
        {% endif %}

        {% if bet.status == 'PENDING' %}
            {% if not is_after_cutoff %}
                <a href="{% url 'delete_bet' bet.id %}"
                   onclick="return confirm('Bạn chắc chắn muốn xóa cược này và nhận lại tiền?');"
                   style="color: red; margin-left: 10px;">
                   [Xóa]
                </a>
            {% endif %}
        {% endif %}
    </li>
    {% empty %}
    <li>Bạn chưa có cược nào hôm nay.</li>
    {% endfor %}
</ul>

<hr>
<h3>Các cược cho ngày mai ({{ tomorrow_date_for_display|date:"d/m/Y" }})</h3>
<ul>
    {% for bet in tomorrow_bets %}
    <li>
        [Chờ xử lý] -
        Lúc: <strong>{{ bet.created_at|time:"H:i" }}</strong> -
        {{ bet.get_bet_type_display }} <strong>{{ bet.number }}</strong> -
        Số tiền: {{ bet.amount }}đ

        <a href="{% url 'delete_bet' bet.id %}"
           onclick="return confirm('Bạn chắc chắn muốn xóa cược này và nhận lại tiền?');"
           style="color: red; margin-left: 10px;">
           [Xóa]
        </a>
    </li>
    {% empty %}
    <li style="color: darkorange;">Chúc bạn may mắn!</li>
    {% endfor %}
</ul>
{% endblock %}