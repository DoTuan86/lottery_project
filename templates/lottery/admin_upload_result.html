{% extends "base.html" %}

{% block content %}
<h2>Admin: Upload Kết Quả Xổ Số Bằng Ảnh</h2>
<p>
    Chụp ảnh màn hình kết quả, chọn ngày, chọn đài và upload ảnh.
    Hệ thống sẽ tự động nhập liệu và tính toán thắng/thua.
</p>

{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li class="{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <p>
        <label for="{{ form.date.id_for_label }}">{{ form.date.label }}:</label>
        {{ form.date }}
        <button type="button" id="setTodayBtn" style="margin-left: 10px;">
            Hôm nay
        </button>
        {% if form.date.errors %}
            <ul class="errorlist">
                {% for error in form.date.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
        {% endif %}
    </p>
    <p>
        <label for="{{ form.station.id_for_label }}">{{ form.station.label }}:</label>
        {{ form.station }}
        {% if form.station.errors %}
            <ul class="errorlist">
                {% for error in form.station.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
        {% endif %}
    </p>
    <p>
        <label for="{{ form.image.id_for_label }}">{{ form.image.label }}:</label>
        {{ form.image }}
        {% if form.image.errors %}
            <ul class="errorlist">
                {% for error in form.image.errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
        {% endif %}
    </p>

    <button type="submit" style="background-color: #007bff; color: white; padding: 10px 15px;">
        Upload và Chạy Tính Toán
    </button>
</form>

<hr>
<p>
    <a href="/admin/">Quay lại trang Admin chính</a>
</p>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var todayBtn = document.getElementById("setTodayBtn");
        var dateInput = document.getElementById("id_date"); // ID này do Django tự tạo

        if (todayBtn && dateInput) {
            todayBtn.addEventListener("click", function() {
                var today = new Date();
                var month = (today.getMonth() + 1).toString().padStart(2, '0');
                var day = today.getDate().toString().padStart(2, '0');
                var year = today.getFullYear();
                var formattedDate = `${year}-${month}-${day}`;
                dateInput.value = formattedDate;
            });
        }
    });
</script>
{% endblock %}